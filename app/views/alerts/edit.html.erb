<h1>Editing Alert</h1>
<div class="container">
  <%= form_tag alert_path, :method => :put, :id => @alert.id do %>
    <div class="row">
      <label class="col-md-2" for="app_name"> Application Name </label>
      <%= text_field '', 'app_name', :value => @alert.app_name %>
    </div>

    <div class="row">
      <label class="col-md-2" for="log_level"> Log Level </label>
      <%= select '', 'log_level', [['Error', 'error'], ['Debug', 'debug'],
                                   ['Fatal', 'fatal'], ['Info', 'info'],
                                   ['Trace', 'trace'], ['Warn', 'warn']],
                 :selected => @alert.log_level %>
    </div>

    <div class="row">
      <label class="col-md-2" for="duration"> Duration </label>
      <%= text_field '', 'hour', :type => "number", :min => 0, :value => @hour %> Hour(s)

      <%= text_field '', 'minute', :type => "number", :min => 0, :value => @minute %> Minute(s)

      <%= text_field '', 'second', :type => "number", :min => 0, :value => @second %> Second(s)
    </div>

    <div class="row">
      <label class="col-md-2" for="limit"> Limit </label>
      <%= text_field '', 'limit', :value => @alert.limit %>
    </div>

    <div class="row">
        <label class="col-md-2" for="callback"> Callback </label>

        <div class="col-md-10">
          <div class="row">
            <%= select '', 'callback', [['Email', 'email'],
                                        ['Slack', 'slack']], include_blank: true,
                       :selected => JSON.parse(@alert.callback)["type"] %>

            <% if JSON.parse(@alert.callback)["type"] == "email" %>
              <span id="add_email_receiver" style="display: block"> Add Receiver</span>
              <span id="add_slack_webhook" style="display: none"> Add Webhook</span>
            <% elsif JSON.parse(@alert.callback)["type"] == "slack" %>
              <span id="add_email_receiver" style="display: none"> Add Receiver</span>
              <span id="add_slack_webhook" style="display: block"> Add Webhook</span>
            <% end %>
          </div>

          <div id="callback_form">
            <% JSON.parse(@alert.callback)["receivers"].each_with_index do |item, idx| %>
              <%= content_tag :div, :id => "inputGroup" + idx.to_s do %>
                <%= text_field '', 'receiver[]', :value => item %>
                <%= content_tag :span, 'Delete', :class => "btn btn-danger", :onclick => "deleteReceiver(\"inputGroup#{idx.to_s}\")" %>
              <% end %>
            <% end %>
          </div>
        </div>
    </div>
    <%= submit_tag 'Update' %>

  <% end -%>

</div>
<%= link_to 'Show', @alert %> |
<%= link_to 'Back', alerts_path %>
